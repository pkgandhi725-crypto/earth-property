<!DOCTYPE html>
<html>
<head>
<title>My Profile - Earth Property</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f2f2f2;}
.cover{height:160px;background:#ccc;position:relative;}
.cover img{width:100%;height:100%;object-fit:cover;}
.profile-pic{
 width:100px;height:100px;border-radius:50%;
 border:4px solid white;
 position:absolute;bottom:-50px;left:20px;
 background:#eee;
}
.profile-pic img{width:100%;height:100%;border-radius:50%;}
.edit-btn{
 position:absolute;bottom:5px;right:5px;
 background:#2e7d32;color:white;border:none;
 padding:5px 8px;border-radius:50%;
}
.box{background:white;margin:70px 10px 10px;padding:15px;border-radius:12px;}
input{width:100%;padding:10px;margin:8px 0;}
button{background:#2e7d32;color:white;border:none;padding:10px;width:100%;border-radius:20px;}
</style>

<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-storage-compat.js"></script>
</head>

<body>

<div class="cover">
  <img id="coverImg" src="https://via.placeholder.com/600x300">
  <input type="file" id="coverInput" hidden>
</div>

<div class="profile-pic">
  <img id="profileImg" src="https://via.placeholder.com/100">
  <button class="edit-btn" onclick="profileInput.click()">✏️</button>
  <input type="file" id="profileInput" hidden>
</div>

<div class="box">
  <input id="name" placeholder="Your Name">
  <input id="phone" placeholder="Phone Number">
  <input id="email" disabled>
  <button onclick="saveProfile()">Save Profile</button>
</div>

<script>
const firebaseConfig = {
 apiKey:"AIzaSyDJ_qGtz1lx_orG4brwp4xUHWdrKctgJ50",
 authDomain:"earth-properties-c3c56.firebaseapp.com",
 projectId:"earth-properties-c3c56"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

let uid=null;

auth.onAuthStateChanged(async user=>{
 if(!user) location.href="login.html";
 uid=user.uid;
 email.value=user.email;

 const doc=await db.collection("users").doc(uid).get();
 if(doc.exists){
  const d=doc.data();
  name.value=d.name||"";
  phone.value=d.phone||"";
  if(d.photoURL) profileImg.src=d.photoURL;
  if(d.coverURL) coverImg.src=d.coverURL;
 }
});

profileInput.onchange = async ()=>{
 const file=profileInput.files[0];
 const ref=storage.ref("profilePhotos/"+uid+".jpg");
 await ref.put(file);
 const url=await ref.getDownloadURL();
 profileImg.src=url;
 db.collection("users").doc(uid).set({photoURL:url},{merge:true});
};

coverImg.onclick=()=>coverInput.click();
coverInput.onchange = async ()=>{
 const file=coverInput.files[0];
 const ref=storage.ref("coverPhotos/"+uid+".jpg");
 await ref.put(file);
 const url=await ref.getDownloadURL();
 coverImg.src=url;
 db.collection("users").doc(uid).set({coverURL:url},{merge:true});
};

function saveProfile(){
 db.collection("users").doc(uid).set({
  name:name.value,
  phone:phone.value,
  email:email.value
 },{merge:true});
 alert("Profile Saved ✅");
}
</script>

</body>
</html>