<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chat – Earth Property</title>

<style>
body{margin:0;font-family:system-ui;background:#f2f2f2;}
header{background:#2e7d32;color:white;padding:12px;font-weight:600;}
#messages{height:calc(100vh - 110px);overflow:auto;padding:10px;}
.msg{max-width:70%;padding:10px;border-radius:12px;margin:6px 0;font-size:14px;}
.me{background:#c8e6c9;margin-left:auto;}
.other{background:white;}
#box{display:flex;padding:10px;background:white;}
#input{flex:1;padding:12px;border:none;border-radius:10px;background:#eee;}
#send{background:#2e7d32;color:white;border:none;padding:12px 16px;border-radius:10px;margin-left:8px;}
</style>
</head>
<body>

<header id="title">Chat</header>
<div id="messages"></div>

<div id="box">
 <input id="input" placeholder="Type message…">
 <button id="send">Send</button>
</div>

<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDJ_qGtz1lx_orG4brwp4xUHWdrKctgJ50",
 authDomain:"earth-properties-c3c56.firebaseapp.com",
 projectId:"earth-properties-c3c56"
});
const db=firebase.firestore();
const auth=firebase.auth();

const url=new URLSearchParams(location.search);
const chatId=url.get("id");
document.getElementById("title").innerText=url.get("title")||"Chat";

auth.onAuthStateChanged(user=>{
 if(!user) location.href="login.html";
 else loadChat(user);
});

function loadChat(user){
 const msgs=db.collection("chats").doc(chatId).collection("messages").orderBy("time");
 msgs.onSnapshot(s=>{
  const box=document.getElementById("messages");
  box.innerHTML="";
  s.forEach(d=>{
   const m=d.data();
   const div=document.createElement("div");
   div.className="msg "+(m.uid===auth.currentUser.uid?"me":"other");
   div.innerText=m.text;
   box.appendChild(div);
  });
  box.scrollTop=box.scrollHeight;
 });

 document.getElementById("send").onclick=async()=>{
  const text=input.value.trim();
  if(!text) return;
  await db.collection("chats").doc(chatId).collection("messages").add({
   text,
   uid:auth.currentUser.uid,
   time:Date.now()
  });
  input.value="";
 };
}
</script>
</body>
</html>