// ... (Purana code wahi rahega, bas loop ke andar ye changes) ...

    const finalUrls = [];
    const storagePaths = []; // ðŸ”¥ New: To track paths for auto-delete
    uploadedRefs = [];
    
    const adUniqueKey = Date.now() + "_" + Math.random().toString(36).substring(2, 7);

    try {
        for(let i=0; i < selectedFiles.length; i++) {
            // Reset Progress Bar for each new image
            progBar.style.width = "0%"; 
            
            const blob = await compressImage(selectedFiles[i]);
            const path = `properties/${user.uid}/${adUniqueKey}/img_${i}.jpg`;
            const ref = storage.ref(path);
            
            const task = ref.put(blob);
            
            await new Promise((resolve, reject) => {
                task.on('state_changed', 
                    (snap) => {
                        let per = (snap.bytesTransferred / snap.totalBytes) * 100;
                        progBar.style.width = per + "%";
                        status.innerText = `Uploading Photo ${i+1}/${selectedFiles.length}: ${Math.round(per)}%`;
                    },
                    (err) => reject(err),
                    async () => {
                        const url = await task.snapshot.ref.getDownloadURL();
                        finalUrls.push(url);
                        storagePaths.push(path); // ðŸ”¥ Track path for future delete
                        uploadedRefs.push(ref);
                        resolve();
                    }
                );
            });
        }

        // Final Firestore Save with Storage Paths
        await db.collection("properties").add({
            title: document.getElementById('title').value,
            price: document.getElementById('price').value,
            images: finalUrls,
            storagePaths: storagePaths, // ðŸ”¥ Ab humare paas map hai!
            location: document.getElementById('location').value,
            phone: document.getElementById('phone').value.replace(/\D/g,''),
            ownerId: user.uid,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        status.innerText = "ðŸš€ LIVE NOW!";
        setTimeout(() => location.href="index.html", 1000);

// ... (Rollback logic wahi rahega) ...
