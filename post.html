<!DOCTYPE html>  
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<title>Post Property - Earth Property</title>  
<meta name="viewport" content="width=device-width, initial-scale=1">  
  
<style>  
body{font-family:system-ui,Arial;background:#f2f2f2;padding:12px;margin:0;}  
header{background:#2e7d32;color:white;padding:16px;text-align:center;border-radius:12px;margin-bottom:12px;}  
#loginStatus{display:none;text-align:center;padding:10px;margin:10px 0;background:#e8f5e8;border-radius:8px;color:#2e7d32;font-weight:600;}  
  
.card{background:#fff;border-radius:14px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.08);margin-bottom:20px;}  
  
input,textarea{  
  width:100%;padding:14px;margin:10px 0;border-radius:10px;border:1px solid #ddd;font-size:16px;box-sizing:border-box;  
  background:#fafafa;  
}  
input:focus,textarea:focus{outline:none;border-color:#2e7d32;background:white;box-shadow:0 0 0 2px rgba(46,125,50,.1);}  
  
button{  
  background:#2e7d32;color:white;border:none;padding:16px;border-radius:25px;width:100%;  
  font-size:18px;font-weight:600;cursor:pointer;transition:.2s;  
  box-shadow:0 4px 12px rgba(46,125,50,.3);  
}  
button:hover:not(:disabled){background:#1b5e20;transform:translateY(-1px);}  
button:disabled{opacity:.6;background:#999;transform:none;}  
  
label.upload{  
  display:block;background:#e8f5e8;padding:16px;border-radius:12px;text-align:center;  
  cursor:pointer;border:2px dashed #2e7d32;margin:10px 0;transition:.3s;font-size:16px;  
}  
label.upload:hover{background:#d4edda;}  
label.upload input{display:none;}  
  
.preview{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0;padding:12px;background:#f8f9fa;border-radius:10px;}  
.preview img{width:72px;height:72px;object-fit:cover;border-radius:10px;border:2px solid #e0e0e0;box-shadow:0 2px 8px rgba(0,0,0,.1);}  
  
#loading{display:none;text-align:center;margin:15px 0;color:#2e7d32;font-weight:600;font-size:16px;}  
#progress{display:none;margin:15px 0;}  
.progress-bar{background:#e0e0e0;height:10px;border-radius:5px;overflow:hidden;box-shadow:inset 0 2px 4px rgba(0,0,0,.1);}  
.progress-fill{background:linear-gradient(90deg,#2e7d32,#4caf50);height:100%;width:0%;transition:width .4s ease;border-radius:5px;box-shadow:0 0 10px rgba(46,125,50,.5);}  
</style>  
  
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>  
</head>  
  
<body>  
  
<header>  
  <h2>‚ûï Post Property</h2>  
  <p>Add your property with photos</p>  
</header>  
  
<div id="loginStatus"></div>  
  
<div class="card">  
<form id="postForm">  
  
  <input id="title" placeholder="üè† Property Title" required>  
  <input id="location" placeholder="üìç Location" required>  
  <input id="price" placeholder="üí∞ Price" required>  
  <input id="phone" placeholder="üì± Phone / WhatsApp" required>  
  <textarea id="description" placeholder="üìù Full Description" rows="4"></textarea>  
  
  <label class="upload">  
    üì∑ Upload Photos (Max 5 images)  
    <input type="file" id="photos" multiple accept="image/*" style="display:none">  
  </label>  
  
  <div class="preview" id="preview"></div>  
  
  <div id="progress">  
    <div class="progress-bar">  
      <div class="progress-fill" id="progressFill"></div>  
    </div>  
  </div>  
  
  <div id="loading">‚è≥ Uploading images and saving...</div>  
  
  <button id="submitBtn" type="submit">üöÄ Post Property</button>  
  
</form>  
</div>  
  
<script>  
const firebaseConfig = {  
  apiKey:"AIzaSyDJ_qGtz1lx_orG4brwp4xUHWdrKctgJ50",  
  authDomain:"earth-properties-c3c56.firebaseapp.com",  
  projectId:"earth-properties-c3c56"  
};  
  
firebase.initializeApp(firebaseConfig);  
const auth = firebase.auth();  
const db = firebase.firestore();  
  
// üîß CLOUDINARY CONFIG  
const cloudName = "dnkhurnbv";  
const uploadPreset = "earth_property";  
  
// DOM Elements  
const form = document.getElementById("postForm");  
const photosInput = document.getElementById("photos");  
const preview = document.getElementById("preview");  
const submitBtn = document.getElementById("submitBtn");  
const loading = document.getElementById("loading");  
const progress = document.getElementById("progress");  
const progressFill = document.getElementById("progressFill");  
const loginStatus = document.getElementById("loginStatus");  
  
/* LOGIN STATUS */  
auth.onAuthStateChanged(user => {  
  if(user) {  
    loginStatus.style.display = "block";  
    loginStatus.innerHTML = `‚úÖ Welcome ${user.email}`;  
  } else {  
    loginStatus.innerHTML = "‚ö†Ô∏è Please login first";  
    loginStatus.style.display = "block";  
    loginStatus.style.background = "#fff3cd";  
    loginStatus.style.color = "#856404";  
  }  
});  
  
/* IMAGE PREVIEW */  
photosInput.addEventListener("change", () => {  
  preview.innerHTML = "";  
  const files = [...photosInput.files].slice(0, 5);  
  if(files.length === 0) return;  
    
  files.forEach(file => {  
    const img = document.createElement("img");  
    img.src = URL.createObjectURL(file);  
    img.onerror = () => img.src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzIiIGhlaWdodD0iNzIiIHZpZXdCb3g9IjAgMCA3MiA3MiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzYiIGN5PSIzNiIgcj0iMzYiIGZpbGw9IiNFMEUwRTAiLz4KPHRleHQgeD0iMzYiIHk9IjQyIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM5OTk5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4K";  
    preview.appendChild(img);  
  });  
});  
  
/* FORM RESET FUNCTION */  
function resetForm() {  
  submitBtn.disabled = false;  
  submitBtn.innerText = "üöÄ Post Property";  
  loading.style.display = "none";  
  progress.style.display = "none";  
  progressFill.style.width = "0%";  
  form.reset();  
  preview.innerHTML = "";  
  photosInput.value = "";  
}  
  
/* SUBMIT HANDLER */  
form.addEventListener("submit", async e => {  
  e.preventDefault();  
    
  submitBtn.disabled = true;  
  submitBtn.innerText = "üì§ Preparing...";  
  loading.style.display = "block";  
  progress.style.display = "block";  
  progressFill.style.width = "0%";  
  
  const user = auth.currentUser;  
  if(!user) {  
    alert("Please login first");  
    resetForm();  
    return;  
  }  
  
  try {  
    // Get form data  
    const title = document.getElementById("title").value;  
    const location = document.getElementById("location").value;  
    const price = document.getElementById("price").value;  
    const phone = document.getElementById("phone").value;  
    const description = document.getElementById("description").value;  
  
    // Upload images to Cloudinary  
    const files = [...photosInput.files].slice(0, 5);  
    const imageUrls = [];  
      
    submitBtn.innerText = "üì§ Uploading images...";  
      
    for(let i = 0; i < files.length; i++) {  
      const file = files[i];  
      const formData = new FormData();  
      formData.append("file", file);  
      formData.append("upload_preset", uploadPreset);  
  
      const response = await fetch(  
        `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`,  
        { method: "POST", body: formData }  
      );  
        
      if(!response.ok) throw new Error(`Upload failed: ${response.statusText}`);  
        
      const data = await response.json();  
      imageUrls.push(data.secure_url);  
  
      // Update progress  
      const progressPercent = Math.round(((i + 1) / files.length) * 70);  
      progressFill.style.width = progressPercent + "%";  
      submitBtn.innerText = `üì§ Image ${i + 1}/${files.length}...`;  
    }  
  
    // Save to Firestore WITH OWNER FIELDS üî•  
    submitBtn.innerText = "üíæ Saving to database...";  
    progressFill.style.width = "90%";  
      
    await db.collection("properties").add({  
      title, location, price, phone, description,  
      images: imageUrls,  
      **ownerId: user.uid,**
      **ownerEmail: user.email,**
      uid: user.uid,  
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),  
      reports: 0  
    });  
  
    progressFill.style.width = "100%";  
    alert("‚úÖ Property posted successfully!");  
      
    // Reset and redirect  
    setTimeout(() => {  
      resetForm();  
      window.location.href = "index.html";  
    }, 500);  
  
  } catch(err) {  
    console.error("Error:", err);  
    alert("‚ùå Error: " + err.message);  
    resetForm();  
  }  
});  
</script>  
  
</body>  
</html>
